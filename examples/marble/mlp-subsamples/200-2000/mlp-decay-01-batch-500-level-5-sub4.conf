# For the weight, remember to adjust to 1/n (1/3, 1/2...)
# For the pre-sigmoid, deducted 0.5
name: "deep-big-simple-mlp"
train_steps: 8002
test_steps:6
validation_steps:4
test_frequency:50
validation_frequency:50
display_frequency:50
debug: true
alg: kBackPropagation
updater{
  base_lr: 0.1
  weight_decay:0.1
  lr_change: kStep
  type: kSGD
  step_conf{
    change_freq: 60
    gamma: 0.997
  }
}

neuralnet {
layer {
  name: "data"
  type: kShardData
  sharddata_conf {
    path: "/data/zhaojing/marble/mlp-samples/subsample4/Marble_08_09_Car_Cla_UMLS_train_shard_4"
    batchsize: 500
  }
  exclude: kTest
  exclude: kValidation
}

layer {
  name: "data"
  type: kShardData
  sharddata_conf {
    path: "/data/zhaojing/marble/mlp-samples/subsample4/Marble_08_09_Car_Cla_UMLS_test_shard_4"
    batchsize: 500
  }
  exclude: kTrain
  exclude: kValidation
}

layer {
  name: "data"
  type: kShardData
  sharddata_conf {
    path: "/data/zhaojing/marble/mlp-samples/subsample4/Marble_08_09_Car_Cla_UMLS_valid_shard_4"
    batchsize: 500
  }
  exclude: kTrain
  exclude: kTest
}

layer{
  name:"MultisrcFData"
  type: kMultiSrcFData
  srclayers: "data"
  multisrcfdata_conf{
    diag_dim: 153
    proc_dim: 185
  }
}

layer{
  name: "flabel"
  type: kFLabel
  srclayers: "data"
}

layer{
  name: "AllSources"
  type: kInnerProduct
  srclayers:"MultisrcFData"
  innerproduct_conf{
    num_output: 2000
  }
  param{
    name: "weight"
    init_method: kUniformSqrtFanInOut
    low:-2.45
    high:2.45
  }
  param{
    name: "bias"
    init_method: kConstant
    value: 0.0
  }
}
# stanh ?????
layer{
  name: "tanh"
  type: kTanh
  srclayers:"AllSources"
}

layer{
  name: "fc1"
  type: kInnerProduct
  srclayers:"tanh"
  innerproduct_conf{
    num_output: 1500
  }
  param{
    name: "weight"
    init_method: kUniformSqrtFanInOut
    low:-2.45
    high:2.45
  }
  param{
    name: "bias"
    init_method: kConstant
    value: 0.0
  }
}

layer{
  name: "tanh1"
  type: kTanh
  srclayers:"fc1"
}

layer{
  name: "fc2"
  type: kInnerProduct
  srclayers:"tanh1"
  innerproduct_conf{
    num_output: 1000
  }
  param{
    name: "weight"
    init_method: kUniformSqrtFanInOut
    low:-2.45
    high:2.45
  }
  param{
    name: "bias"
    init_method: kConstant
    value: 0.0
  }
}

layer{
  name: "tanh2"
  type: kTanh
  srclayers:"fc2"
}

layer{
  name: "fc3"
  type: kInnerProduct
  srclayers:"tanh2"
  innerproduct_conf{
    num_output: 600
  }
  param{
    name: "weight"
    init_method: kUniformSqrtFanInOut
    low:-2.45
    high:2.45
  }
  param{
    name: "bias"
    init_method: kConstant
    value: 0.0
  }
}

layer{
  name: "tanh3"
  type: kTanh
  srclayers:"fc3"
}

layer{
  name: "fc4"
  type: kInnerProduct
  srclayers:"tanh3"
  innerproduct_conf{
    num_output: 200
  }
  param{
    name: "weight"
    init_method: kUniformSqrtFanInOut
    low:-2.45
    high:2.45
  }
  param{
    name: "bias"
    init_method: kConstant
    value: 0.0
  }
}

layer{
  name: "tanh4"
  type: kTanh
  srclayers:"fc4"
}

layer{
  name: "fc5"
  type: kInnerProduct
  srclayers:"tanh4"
  innerproduct_conf{
    num_output: 1
  }
  param{
    name: "weight"
    init_method: kUniformSqrtFanInOut
    low:-2.45
    high:2.45
  }
  param{
    name: "bias"
    init_method: kConstant
    value: 0.0
  }
}

layer{
  name: "loss"
  type:kLogisticLoss
  srclayers:"fc5"
  srclayers:"flabel"
}
}
